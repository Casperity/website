<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard â€“ HonHonStinks</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#111; color:#eee; }
    #loader { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; font-size:1.5rem; background:#0008; }
    #error { color:#f66; text-align:center; padding:4rem; }
  </style>
</head>
<body>
  <div id="loader">Loading protected dashboard...</div>
  <div id="content" style="display:none;"></div>

  <script>
    const backendBase = "https://api.honhonstinks.lol/dashboard";

    async function init() {
      try {
        const res = await fetch(backendBase, {
          credentials: "include",  // sends the HttpOnly JWT cookie
          headers: { "Accept": "text/html" }
        });

        if (!res.ok) {
          if (res.status === 401 || res.status === 403) {
            document.body.innerHTML = `
              <div id="error">
                <h1>Access Denied</h1>
                <p>Please <a href="/" style="color:#4af">log in</a> first.</p>
                ${res.status === 401 ? '<p>(Your session may have expired)</p>' : ''}
              </div>
            `;
            return;
          }
          throw new Error(`HTTP ${res.status}`);
        }

        const html = await res.text();
        document.getElementById("loader").remove();
        document.getElementById("content").innerHTML = html;
        document.getElementById("content").style.display = "block";

        // Optional: re-execute any <script> tags in the loaded HTML (if needed)
        Array.from(document.querySelectorAll("#content script")).forEach(oldScript => {
          const newScript = document.createElement("script");
          Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
          newScript.appendChild(document.createTextNode(oldScript.innerHTML));
          oldScript.parentNode.replaceChild(newScript, oldScript);
        });
      } catch (err) {
        document.body.innerHTML = `<div id="error"><h1>Error</h1><p>${err.message}</p><a href="/">Back</a></div>`;
      }
    }

    init();
  </script>
</body>
</html>
